<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Game of Thrones : build your webapp</title>
		<link rel="stylesheet" type="text/css" href="styles/style.css">
		<link href="prettify/prettify.css" type="text/css" rel="stylesheet" />
		<script src="prettify/prettify.js" defer="defer"></script>
		<script src="prettify/lang-dart.js" defer="defer"></script>
		<script src="prettify/lang-yaml.js" defer="defer"></script>
	</head>
	<body onload="prettyPrint()">
		<h1>EclipseCon Dart Workshop</h1>
		<p>In this lab, you will build a web application from scratch : both the server and client sides. Some samples will be given to you, but these are just base data and boilerplate, everything will be built from scratch. Some programming skills are necessary, but you don't need to know anything about Dart first. During all the lab, don't hesitate to ask questions or for help if you are stuck.</p>

		<p>Here is what you should get in the end !</p>
<!--
		<iframe src="http://you-know-nothing.com/" class="finished-app"></iframe>
-->
		<div class="map">
			<h2>Winter is coming...</h2>
			<ul>
				<li><a href="#step0">Step 0: Set up</a></li>
				<li><a href="#step1">Step 1: Your first command-line application</a></li>
				<li><a href="#step2">Step 2: Your first Dart HTTP server</a></li>
				<li><a href="#step3">Step 3: Serving real content</a></li>
				<li><a href="#step4">Step 4: Our first web page</a></li>
			</ul>
		</div>

		<h2 id="step0">Step 0: Set up</h2>
		<p>In this step, you will install, both Dart Editor, the SDK and everytools needed.</p>
		
		<h3>Prerequisite : JDK</h3>
		<p>Dart Editor requires Java version 6 or higher. Please, fill free to use theses provided on the USB keys if you don't allready have it installed.<br>Use a version compatible with your Operating System (32 or 64 bits). If you still have problems, go to <a href="https://www.dartlang.org/tools/editor/troubleshoot.html">this troubleshoot guide</a> or simply ask for help.</p>
		
		<h3>Get Dart</h3>
		<p>Just copy the folder corresponding to your Operating System somewhere on your hard drive. Please, use a version (32/64 bits) matching the version of your installed JDK.</p>
		
		<h3>Start the editor</h3>
		<p>Go to the dart directory and double-click DartEditor.</p>

		<h2 id="step1">Step 1: Your first command-line application</h2>
		<p>Now that your Dart Editor is up and running, we will test his basic functionalities.</p>
		
		<h3>Create a new command-line project</h3>
		<p>In the top menu, go to <strong>File -> New Project...</strong><br>
		Name it as you want : got-server will be a good one<br>
		Check "Generate sample content"<br>
		Choose <strong>"Command-line application"</strong> from the list</p>
		<h3>Have a look at the different folders</h3>
		<div class="row">
			<div class="col6">
				<p>You should get a project structure similar to the following one :</p>
				<img src="images/step1.png">
			</div>
			<div class="col6">
				<p><strong>Side notes</strong></p>
				<ul>
					<li><p>The <code>packages</code> directory will contain all the dependencies we use in the project. We currently have none, we will get to it quite soon. The <code>pubspec.lock</code> file is simply a list of the allready downloaded packages. Dart Editor should handle these for you.</p></li>
					<li><p>The <code>pubspec.yaml</code> file describes our project and its dependencies.</p></li>
					<li><p>The <code>bin</code> folder will contain our Dart source files. There should only be one for now.</p></li>
				</ul>
			</div>
		</div>
		
		<div class="note">
			<strong>Note:</strong>If you have some red X's, I bet it's a connection problem. Please, copy the repository found on the USB keys and directly link to it for each of your dependencies in your <code>pubspec.yaml</code> file: 
			<pre class="prettyprint lang-yaml" filename="test">
dependencies:
	my_dependency:
		path: /path/to/the/folder/my_dependency
			</pre>
			<div class="filename">pubspec.yaml</div>
		</div>

		<h3>Choose the String that will be printed</h3>
		<p>Simply choose what will be printed. Don't be affraid and try String interpolation while generating your message.</p>

		<h3>Execute your application</h3>
		<p>Right click on your dart file and select Run. You can also use the Ctrl + R shortcut.</p>
		<p>Is your message printed on the console?</p>
		
		<h2 id="step2">Step 2: Your first Dart HTTP server</h2>
		<p>Ok, we have something that runs on our computer, but we are supposed to build a web application. Where is my server?</p>
		<h3>Code a webserver</h3>
		<p>Don't worry, it's quite easy. We will use the <strong>HttpServer</strong> class found in the <code>dart:io</code> package.</p>
<pre class="prettyprint lang-dart">
<code class="nocode note">1</code> <code class="nocode highlight">import 'dart:io';</code>

main() {
<code class="nocode note">2</code>  HttpServer.bind('localhost', 8080).then((HttpServer server) {
<code class="nocode note">3</code>    print('Server started on port ${server.port}');
<code class="nocode note">4</code>    server.listen((HttpRequest request) {
          request.response..write('Hello EclipseCon!');
          	                ..close();
    });
  });
}
</pre>
<div class="filename">got_server.dart</div>
		<p><span class="code-note">1</span> We must import the <code>dart:io</code> package in order to use the HttpServer class and everything related to inputs/outputs.</p>
		<p><span class="code-note">2</span> We bind our webserver to the localhost address (IP 127.0.0.1, or 0.0.0.0) on port 8080.<br>
		This bind method returns a Future. As we have seen, we can call the <code>then</code> method on this future with a function that will be executed once the Future completes.</p>
		<p><span class="code-note">3</span> We simply print that our server successfully started.</p>
		<p><span class="code-note">4</span> We register a method to execute on incoming requests.</p>
		<h3>Execute and test it</h3>
		<p>Run your dart file again, it should print that your webserver started.</p>
		<p>If it's the case simply head to <a href="http://localhost:8080">http://localhost:8080</a> with your favorite web browser.</p>
		<p>It should print your message, isn't it?</p>

		<h2 id="step3">Step 3: Serving real content</h2>
		<p>Fine, we are able to print a String from our webserver and see it in our web browser. We will now serve usefull data instead of a simple message. In our case, a JSON (Javascript Serialization Object Notation).</p>
		<h3>Source file</h3>
		<p>Start by copying the file <code>characters.json</code> in the <code>bin</code> folder of your project.</p>
		<h3>Reading our file</h3>
		<p>We will simply put the file content in our response for now. We will improve this part much later.</p>
<pre class="prettyprint lang-dart">
import 'dart:io';

main() {
  File jsonFile = new File("characters.json");
  String fileContent = jsonFile.readAsStringSync();
  ...
        request.response..write(fileContent);
                        ..close();
  ...
}
</pre>
<div class="filename">got_server.dart</div>
		
		<div class="note">
			<strong>Note:</strong> Here we use the <code>readAsStringSync()</code> method which is a synchronous method to be sure the file has been completely read before starting the webserver. Another way to do would have been to use the <code>readAsString()</code> method which returns a Future and process with the server launch in the handler method.
		</div>

		<h3>Rince, repeat...</h3>
		<p>Simply stop and run your webserver again, you should be used to it as it's the third time.</p>
		<p>Check in your web browser that the file content is printed.</p>

		<h2 id="step0">Step 4: Our first web page</h2>

	</body>
</html>